{
  "question_id" : 44825937,
  "title" : "Heatmap (ComplexHeatmap), how to use hclust",
  "body" : "<p>I am having some problems in understanding how to use hclust in Heatmap (complexHeatmap package from Bioconductor).</p>\n\n<p>My matrix M is as follow</p>\n\n<pre><code>                      a           b            c           d           e            f\n  [1,] -1.951311216  0.50590680  0.513855615  0.08896402  0.02790575  0.814679034\n  [2,] -1.524650729 -0.64211924  0.479974130 -0.28015314  1.08301829  0.883930692\n  [3,]           NA  0.79894923  0.390991316  0.53931210          NA  0.819093536\n  [4,]  0.380548218 -1.51608209 -0.788904246  1.29081429  0.50034274  0.133281082\n  [5,]           NA  0.84157138  0.942885242          NA          NA  0.952095507\n  [6,]           NA          NA           NA  1.22116043          NA  1.358395914\n  [7,] -0.220496288  0.49544616 -1.306003509  1.64112551 -0.55088399 -0.059187880\n  [8,]  0.265380791 -0.75364152 -1.477866259  0.09513603  0.47824591  1.392745059\n  [9,]  0.398252550          NA  0.518196864  0.57499663  0.61606697 -0.147693128\n [10,]  0.362020127 -2.02682789  0.413286499  0.45012924  0.58286830  0.218523722\n [11,]  0.384497881 -0.73492616 -0.661744450  1.03772779 -1.19534543  1.169790379\n [12,]           NA          NA           NA          NA          NA  2.041241452\n [13,]  0.919602536 -1.17098606 -1.255694103 -0.04466404  0.76156777  0.790173895\n [14,]  0.308635168          NA  0.206254807  0.78989272  0.25089820  0.439790723\n [15,]  0.469213059 -0.67359430 -1.391222301  1.43968262 -0.31304377  0.468964697\n [16,] -0.560353930 -1.09270426  0.841718305  1.04097762 -1.02956200  0.799924266\n [17,]  0.520399079  0.32500129           NA  0.08458703  0.63386381  0.441145396\n [18,] -0.835237288 -0.07578019 -0.416994394  0.61818326 -0.96581898  1.675647594\n [19,]  1.408450691 -0.34307672 -0.852238041  0.89694679 -1.16806663  0.057983906\n [20,]  0.893211303 -0.46746826  0.643729941 -1.80967699  0.47104003  0.269163977\n [21,]           NA  1.11537439           NA          NA          NA  1.451948220\n [22,]  0.728991474          NA  0.536140022  0.50592432          NA  0.795197206\n [23,] -0.053178761  0.21487931 -0.209684269  0.45919846 -1.72409665  1.312881912\n [24,]           NA  0.39196726  0.413632226  0.32397755  0.49139182  0.417333287\n [25,]  0.392458982  0.48538967  0.278735865  0.69771832  0.15142375           NA\n [26,]  0.358901947          NA  0.471769313  0.57531677  0.20837291  0.411657873\n [27,]           NA  0.86262860           NA  0.86888356          NA  1.003622834\n [28,]           NA          NA           NA  1.19001305          NA  1.386963291\n [29,]           NA  0.55534941  0.418296488  0.35152992  0.50453278  0.195229409\n [30,]  0.503249813          NA  0.580655461  0.81486386          NA  0.669331670\n [31,]  0.623331182  0.58617213           NA  0.63281714          NA  0.736453896\n [32,] -0.616152957  0.54351427  0.294244109  1.44132265 -0.20764824 -1.455279836\n [33,]  0.566251482 -0.76605576  0.516844610 -1.09005850 -0.69478260  1.467800767\n [34,] -0.469367932 -0.17160939  0.075835063  0.94450467 -1.56453502  1.185172604\n [35,] -0.025015271  0.48541953 -0.054072300  0.72528460 -1.90642428  0.774807727\n [36,]           NA          NA           NA  1.29663851          NA  1.285333888\n [37,] -0.365069691  1.33507386 -0.904648200  0.03686296 -1.11396654  1.011747606\n [38,]  0.572174476  0.76152729  0.627905670  0.61519678          NA           NA\n [39,]  1.178356127 -0.57927184 -0.851365409  0.90913483  0.54014766 -1.197001372\n [40,]  0.490606858 -1.35783467  0.317366076  1.47021024 -0.12118321 -0.799165296\n [41,]  0.947443136 -0.62902033 -0.217310877  0.74096909  0.75281542 -1.594896444\n [42,]  0.533587594  0.71146504           NA  0.61522478          NA  0.715835725\n [43,]  0.464751415  0.40837917  0.222332443  0.48961974          NA  0.446778933\n [44,] -0.013700611  0.06084755 -1.489655766  0.90549770 -0.68357611  1.220587231\n [45,] -0.491064039  1.31262109 -0.919689194  1.16650872 -0.89376924 -0.174607335\n [46,]  0.406068052  0.47647334           NA  0.65258665  0.20768673  0.273227304\n [47,] -0.444857763 -0.36586344 -0.777452093  1.33135956 -0.93421226  1.191025995\n [48,]           NA  0.69879228  0.268017962  0.34346934  0.09218128  0.589106527\n [49,]  0.825653200          NA           NA  1.11010393  0.78566020           NA\n [50,]  0.555694835  0.70628223           NA  0.61496162          NA  0.700976362\n [51,]  0.260521079          NA  0.493406025  0.76308627  0.21088808  0.269425445\n [52,]  0.415731274  0.49391104  0.448352135  0.50486315  0.16223334           NA\n [53,]  0.417621197  0.58403250  0.116957435  0.50121124          NA  0.395844711\n [54,]           NA  0.94669678           NA  0.89611543          NA  0.895326014\n [55,]           NA  0.82528832           NA          NA  0.73378146  1.152825175\n [56,]  1.075157625          NA           NA  0.72810565          NA  0.918753082\n [57,]  0.928062237          NA           NA  0.90792339          NA  0.902527960\n [58,]           NA  0.77760169  0.273229533  0.64731719          NA  0.834051885\n [59,]  0.300473280  0.66406432  0.182531639  0.63261069  0.21731629           NA\n [60,] -0.004981697  1.10482824  0.188908594  0.39811455 -1.88323853  0.196368853\n [61,]           NA  1.31105112           NA          NA  1.27072786           NA\n [62,]           NA  0.60074858  0.411544684  0.86267258  0.67979638           NA\n [63,]           NA          NA           NA          NA          NA  2.041241452\n [64,]  0.729614551          NA           NA  0.81229426          NA  1.166973264\n [65,]           NA  1.28473149           NA          NA  1.29723722           NA\n [66,]  0.376349624  0.27452845           NA  0.57687679  0.32121927  0.479978162\n [67,]           NA          NA           NA  1.05486287          NA  1.501269747\n [68,]  0.083789384  0.71056459           NA  0.60879194  0.12981736  0.442982890\n [69,] -0.557504198  0.01734045 -0.231059614  1.78672588 -1.18873870  0.173236182\n [70,] -0.887768133  0.81586675 -0.461195184  1.33702455 -1.18386662  0.379938645\n [71,] -1.281856987  1.49512587 -0.191632791 -0.17089518  0.79725457 -0.647995483\n [72,] -1.089309440  0.31559862 -0.109634089  0.33046977  1.58787515 -1.035000022\n [73,]           NA          NA           NA  2.04124145          NA           NA\n [74,]  0.336448458 -0.55938684  0.385242638 -1.43300095  1.51983977 -0.249143078\n [75,] -0.141295443 -1.06508099  1.675057227  0.11213459 -0.94560764  0.364792254\n [76,]  0.552640588          NA           NA  0.89529077  1.22757288           NA\n [77,]  0.674445968 -1.41109988 -0.008929067 -0.31094816  1.50269418 -0.446163044\n [78,]           NA  1.17342548           NA          NA          NA  1.401820244\n [79,]           NA  1.39164098           NA          NA          NA  1.184819770\n [80,]  0.602296304 -0.83500676 -0.782785791  1.69483094 -0.67436836 -0.004966338\n [81,] -0.588657140  1.03512046 -0.530023909  0.11795718 -1.29910656  1.264709966\n [82,]  1.450451376 -1.59936312 -0.341827637 -0.11102973  0.41918850  0.182580612\n [83,]           NA          NA  1.222440856  1.35720244          NA           NA\n [84,]  1.340919351 -0.49070087  0.324216892  0.04341001  0.41883537 -1.636680745\n [85,] -1.324222326 -0.80753819  0.319809915  0.15534985  1.56848357  0.088117179\n [86,]  0.006678114 -1.11409452 -0.626621301  1.29004239 -0.67335682  1.117352134\n [87,]  0.916658381          NA           NA  0.89382801  0.92796080           NA\n [88,]  0.907929277  0.41907710 -1.800484395  0.16257805 -0.42915832  0.740058283\n [89,]  0.093810534  1.45466030 -0.904627209  0.90377334 -0.91949172 -0.628125245\n [90,]  0.555936583  0.72080877           NA          NA  0.43375344  0.845921886\n [91,]  1.433613279 -1.27891393 -0.575272208  0.86920597 -0.47133797  0.022704857\n [92,] -1.108307714 -0.27287462 -0.059377319  0.04792346 -0.47022666  1.862862855\n [93,]  0.397280311  0.31067512 -1.994427009  0.06794890  0.50704975  0.711472930\n [94,]  0.440369671  0.39862900 -2.033807046  0.47389005  0.47527419  0.245644140\n [95,] -0.498863117  1.06500608 -0.888247441  0.17270987  1.25514765 -1.105753046\n [96,] -0.775588171 -0.48320045  1.836018373  0.48196915 -0.50995982 -0.549239079\n [97,] -0.086403793 -0.63554908 -0.445403933  1.52564798  0.82046410 -1.178755273\n [98,]  0.374307340          NA  0.683243862  0.14810983  0.39567672  0.410205591\n [99,]  0.815123222  0.66379060           NA          NA  0.49343811  0.595479512\n[100,] -0.315234075  1.35879465 -0.472622294  0.07632297 -1.46722889  0.819967641\n</code></pre>\n\n<p>Now I would like to use the following functions for the clustering</p>\n\n<pre><code>hclustfunc &lt;- function(x){\n  hclust(x, method = \"ward.D2\") \n}\n\ndistfunc &lt;- function(x){\n  ret &lt;- daisy(x, \"gower\")\n  ret[which(is.na(ret))] &lt;- 1\n  return(ret)\n}\n</code></pre>\n\n<p>Now I have this for making the heatmap</p>\n\n<pre><code>Heatmap(M, na_col = \"black\", name = \"iBAQ\", clustering_distance_rows = distfunc, show_row_names = FALSE, col = colorRampPalette(brewer.pal(10, \"RdBu\"))(256))\n</code></pre>\n\n<p>But I do not understand where/how I can specify to use <code>hclustfunc</code> (the ward.D2 method)</p>\n\n<p>Everytime I try something I get an error message, for <code>cluster_rows = hclustfunc</code> I get</p>\n\n<pre><code> Error in if (is.na(n) || n &gt; 65536L) stop(\"size cannot be NA nor exceed 65536\") : \n  missing value where TRUE/FALSE needed\n</code></pre>\n\n<p>or for <code>clustering_method_rows = hclustfunc</code> I get</p>\n\n<pre><code>Error in method == \"ward\" : \n  comparison (1) is possible only for atomic and list types\n</code></pre>\n\n<p>Using <code>heatmap.3</code> I was able to obtain what I wanted</p>\n\n<pre><code>heatmap.3(M, col = colorRampPalette(brewer.pal(10, \"RdBu\"))(256),labRow = \"\", na.color = \"black\", dendrogram = \"both\", hclust = hclustfunc, distfun = distfunc)\n</code></pre>\n\n<p>but I rather prefer to use <code>Heatmap</code>\nWhat am I doing wrong?</p>\n",
  "link" : "https://stackoverflow.com/questions/44825937/heatmap-complexheatmap-how-to-use-hclust",
  "owner" : {
    "user_id" : 8035750,
    "user_type" : "registered",
    "display_name" : "pisistrato",
    "profile_image" : "https://i.stack.imgur.com/iCXXV.jpg?s=128&g=1",
    "link" : "https://stackoverflow.com/users/8035750/pisistrato",
    "reputation" : 11,
    "accept_rate" : null
  },
  "is_answered" : false,
  "creation_date" : 1498741388,
  "last_activity_date" : 1498741388,
  "tags" : [
    "r",
    "heatmap",
    "bioconductor",
    "hclust"
  ],
  "score" : 0,
  "view_count" : 10,
  "answer_count" : 0
}