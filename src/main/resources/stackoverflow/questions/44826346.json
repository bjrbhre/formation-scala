{
  "question_id" : 44826346,
  "title" : "res.render double in nodejs",
  "body" : "<p>I sent this query which I used to fill a table in <code>jade</code></p>\n\n<pre><code>getAnalisisDetallado: function(req, res, next) {\n        console.log('Entro aqui');\n        var config = require('.././database/config');\n        var articulos = null;\n        var usuarios;\n        sql.connect(config)\n            .then(function() {\n                var request = new sql.Request();\n                request.query(\"SELECT DISTINCT t.SI_Articulo,  m.SI_Descripcion,  t.SI_UM, (CASE WHEN c.SI_OV IS NOT NULL THEN '*' ELSE NULL END) AS SI_OV, (SELECT COUNT(t3.SI_Ubicacion) from SI_Inventario_Teorico_QAD t3 WHERE t.SI_Articulo = t3.SI_Articulo)  AS SI_Ubicacion, (SELECT SUM(t2.SI_Existencia)  from SI_Inventario_Teorico_QAD t2 WHERE t.SI_Articulo = t2.SI_Articulo) as SI_Existencia, c.SI_Cantidad, c.SI_Cantidad - t.SI_Existencia AS SI_Dif ,(c.SI_Cantidad - t.SI_Existencia) * m.SI_Costo_Promedio AS SI_Dif_Dinero FROM SI_Inventario_Teorico_QAD t INNER JOIN SI_Maestro_Ref_QAD m ON m.SI_Num_Articulo = t.SI_Articulo LEFT JOIN SI_Conteo c ON c.SI_Num_Articulo = t.SI_Articulo GROUP BY t.SI_Articulo, m.SI_Descripcion, t.SI_UM, c.SI_OV, t.SI_Existencia, c.SI_Cantidad,m.SI_Costo_Promedio\")\n                    .then(function(recordset) {\n                        articulos = recordset['recordset'];\n                        console.log('Recordset: ' + recordset);\n                        console.log('Affected: ' + request.rowsAffected);\n                        //console.log(articulos);\n                        sql.close();\n                        res.render('menu/analisisDetallado', { ListArticulos: articulos });\n                        next();\n\n                    })\n                    .catch(function(err) {\n                        console.log('Request error: ' + err);\n                    });\n            })\n            .catch(function(err) {\n                if (err) {\n                    console.log('SQL Connection Error: ' + err);\n                }\n            });\n\n\n    }\n</code></pre>\n\n<p>Brings them and puts them perfectly. Now in the same table there is a button which shows me the detailed article then with ajax I bring the number of the article</p>\n\n<pre><code>$(function(){\n    //function ajax\n    $('#example-table #analisiInterno').click(function(e){\n        e.preventDefault();\n        var elemento = $(this);\n        var id = elemento.parent().parent().find('#id_articulo').text();\n        //alert(id);\n\n        $.ajax({\n            url: 'http://localhost:3000/visualizarArticulo',\n            method: 'post',\n            data : {id: id},\n            success : function(res){\n                console.log(res);\n            }\n        })\n    })\n});\n</code></pre>\n\n<p>To be able to do the new consult</p>\n\n<pre><code>getVisualizarArticulo: function(req, res, next) {\n        console.log('Entra al otro');\n        var id = req.body.id;\n        var config = require('.././database/config');\n        console.log(id);\n        var respuesta = { res: false };\n        sql.connect(config)\n            .then(function() {\n                var request = new sql.Request();\n                request.query(\"SELECT SI_Articulo, SI_Ubicacion, SI_Existencia FROM SI_Inventario_Teorico_QAD WHERE SI_Articulo = '\" + req.body.id + \"'\")\n                    .then(function(recordset) {\n                        detalle = recordset['recordset'];\n                        console.log('Recordset: ' + recordset);\n                        console.log('Affected: ' + request.rowsAffected);\n                        console.log(detalle);\n                        sql.close();\n                        respuesta.res = true;\n                        res.json(respuesta);\n                        console.log(respuesta);\n\n                        res.render('menu/analisisDetallado', { ListDetalle: detalle });\n\n                    })\n                    .catch(function(err) {\n                        console.log('Request error: ' + err);\n                    });\n            })\n            .catch(function(err) {\n                if (err) {\n                    console.log('SQL Connection Error: ' + err);\n                }\n            });\n    }\n</code></pre>\n\n<p>My doubt is that being the same res.render <code>res.render('menu/analisisDetallado', { ListDetalle: detalle });</code><br>\ntells me that</p>\n\n<blockquote>\n  <p>Cannot read property 'length' of undefined</p>\n</blockquote>\n\n<p>As I do to pass the res.render again to the same route taking into account that I must first make the first query to fill the table.</p>\n\n<p>And this is the <code>jade</code> view</p>\n\n<pre><code>div(class=\"container aDetallado\")\n    div(class=\"row center span10\")\n      table(id='example-table' class='table table-striped table-hover table-condensed')\n        thead\n          tr\n            th='Articulo'\n            th='Descripci√≥n'\n            th='Um'\n            th='Ov'\n            th='#Ubic'\n            th='Teorico'\n            th='Conteo2'\n            th='Dif'\n            th='Dif $'\n            th='Asignar conteo'\n            th='Seleccionar'\n              input(type=\"checkbox\")\n\n          tbody\n            each Articulos in ListArticulos\n              tr\n                td(id='id_articulo')= Articulos.SI_Articulo\n                td= Articulos.SI_Descripcion\n                td= Articulos.SI_UM\n                td= Articulos.SI_OV\n                td\n                  button(type='button' id='analisiInterno' class='btn btn-danger' data-toggle='modal' data-target='#myModal')= Articulos.SI_Ubicacion\n                td= Articulos.SI_Existencia\n                td= Articulos.SI_Cantidad\n                td= Articulos.SI_Dif\n                td= Articulos.SI_Dif_Dinero\n                td\n                  select(class='form-control widthSelect' name='mood')\n                    option(value=\"0\") -- Seleccione usuario --\n                    option(value=\"1\") 1020433143\n                    option(value=\"2\") 1026138136\n                    option(value=\"3\") 1037618420\n                    option(value=\"4\") 1128430921\n                    option(value=\"5\") 1152683886\n                    option(value=\"6\") 15255651\n                    option(value=\"7\") 43222012\n                    option(value=\"8\") 71268442\n                    option(value=\"9\") 71703960\n                    option(value=\"10\") 8463111\n                    option(value=\"11\") 98514535\n                    option(value=\"12\") 98643619\n                    option(value=\"13\") Admin\n                td\n                  div(class='checkbox')\n                    label\n                      input(type='checkbox' autocomplete='off')\n                      span(class='cr')\n                        i(class='cr-icon glyphicon glyphicon-ok')\n  form(action=\"/menu/analisisDetallado\" method=\"post\")\n    div(class='container')\n      div(id='myModal' class='modal fade' role='dialog')\n        div(class='modal-dialog')\n          div(class='modal-content')\n            div(class='modal-header')\n              button(type='button' class='close' data-dismiss='modal')= 'X'\n              h4(class='modal-title')= 'Analisis interno'\n            div(class='modal-body')\n              table(class='table table-striped table-hover table-condensed')\n                thead\n                  tr\n                    th='Articulo'\n                    th='Ubicacion'\n                    th='Teorico'\n                  tbody\n                    for Detalle in ListDetalle\n                      tr\n                        td= Detalle.SI_Articulo\n                        td= Detalle.SI_Ubicacion\n                        td= Detalle.SI_Existencia            \n            div(class='modal-footer')\n              button(type='button' class='btn btn-danger' data-dismiss='modal')= 'Cerrar'\n</code></pre>\n\n<p>Or a different way to fill the table that is in the popup?</p>\n",
  "link" : "https://stackoverflow.com/questions/44826346/res-render-double-in-nodejs",
  "owner" : {
    "user_id" : 7759780,
    "user_type" : "registered",
    "display_name" : "Eduard",
    "profile_image" : "https://www.gravatar.com/avatar/41e05833103c1153a267f2ebc302b3a9?s=128&d=identicon&r=PG&f=1",
    "link" : "https://stackoverflow.com/users/7759780/eduard",
    "reputation" : 1,
    "accept_rate" : null
  },
  "is_answered" : false,
  "creation_date" : 1498742508,
  "last_activity_date" : 1498742508,
  "tags" : [
    "javascript",
    "node.js"
  ],
  "score" : -1,
  "view_count" : 15,
  "answer_count" : 0
}