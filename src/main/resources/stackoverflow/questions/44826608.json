{
  "question_id" : 44826608,
  "title" : "Updating 600k rows, most of the columns are Varchar2(45). This update is taking too long ( 30 minutes ). Is there a better way to write the update?",
  "body" : "<p>--Update address fields in address table with corrects address</p>\n\n<p>the columns in the temp table are columns from address table and to be modified columns in address table. This update takes 30 minutes which will not work for our prod environment. How can i write this code to make it run faster?        </p>\n\n<pre><code>DECLARE\n       --Fetching data from temp table created for address update\n       CURSOR My_Cursor\n       IS\n            --Fetching records which have a valid error code which is 2,4,5,20,46\n            SELECT A.*\n              FROM Fix_Dba.Temp_Address_Cleanup A, Fix_Dba.Addresses B\n             WHERE A.Address_Id = B.Address_Id\n          ORDER BY A.Address_Id;\n\n   TYPE Plt_Cursor IS TABLE OF My_Cursor%ROWTYPE\n      INDEX BY BINARY_INTEGER;\n\n   Plt_Cursorarr     Plt_Cursor;            --Array declaration for the cursor\n\n   --Track the address_ids which are not found in address_table\n   CURSOR Record_Not_Found\n   IS\n        SELECT A.Address_Id\n          FROM Fix_Dba.Temp_Address_Cleanup A\n         WHERE A.Address_Id NOT IN (SELECT B.Address_Id\n                                      FROM Fix_Dba.Addresses B)\n      ORDER BY A.Address_Id;\n\n   --declaring counter to commit records at certain intervals\n   Counter           NUMBER := 0;\n   V_Address_Id      NUMBER := 0;\n   V_Err_Message     VARCHAR2 (5000);\n   V_Efacts_Log_Id   NUMBER;\nBEGIN\n   OPEN My_Cursor;                                               --Open cursor\n\n   FETCH My_Cursor BULK COLLECT INTO Plt_Cursorarr; --Fetching data which is required to update address fields\n\n   CLOSE My_Cursor;\n\n   IF Plt_Cursorarr.COUNT = 0 --Return if the count is zero and there are no records to process\n   THEN\n      RETURN;\n   END IF;\n\n   FOR I IN Plt_Cursorarr.FIRST .. Plt_Cursorarr.LAST --For loop declaration to update records\n   LOOP\n\n      BEGIN\n         --Updating address fileds in address table after fetching correct data from temporary tables\n         UPDATE Fix_Dba.Addresses A\n            SET A.Address1 = Plt_Cursorarr (I).Address1_New, --Updating address line 1\n                A.Address2 = Plt_Cursorarr (I).Address2_New, --Updating address line 2\n                A.City = Plt_Cursorarr (I).City_New,           --Updating city\n                A.State_Code = Plt_Cursorarr (I).State_Code_New, --Updating State\n                A.Zip_Code = Plt_Cursorarr (I).Zip_Code_Addon, --Updating Zip code\n                A.Update_Date = SYSDATE,\n                A.Sysuser_Id_Updated_By = 1,\n                A.Update_Source = 'LOG17690'\n          WHERE A.Address_Id = Plt_Cursorarr (I).Address_Id; --Where clause for update\n\n         Counter := Counter + 1; --Increment the counter to account for number of records\n\n         IF MOD (Counter, 10000) = 0\n         THEN                                    -- Commit every 10000 records\n            COMMIT;\n            Counter := 0; --Putting the counter value back to zero so that the counter for commit can restart\n         END IF;\n      EXCEPTION      --Handling exceptions... do we need to track address_ids?\n         WHEN OTHERS\n         THEN\n            V_Err_Message := 'ERROR: ' || SQLCODE || ';' || SQLERRM;\n            Fix_Dba.Dbpc_Blaster_Inserts.Write_Log (\n               NULL,\n               NULL,\n               NULL,\n               17690,\n               'ADDRESS',\n               V_Err_Message,\n               'E',\n               'AddressID',\n               Plt_Cursorarr (I).Address_Id,\n               V_Efacts_Log_Id);\n\n      --           DBMS_OUTPUT.Put_Line ('Updated ' || SQL%ROWCOUNT || ' rows.');\n      --           DBMS_OUTPUT.Put_Line ('Error occurred with error code: ' || SQL%BULK_EXCEPTIONS (I).ERROR_CODE);\n\n      END;\n   END LOOP;\n\n   COMMIT;\n\n   BEGIN\n      OPEN Record_Not_Found;\n\n      LOOP\n         FETCH Record_Not_Found INTO V_Address_Id;\n\n         EXIT WHEN Record_Not_Found%NOTFOUND;\n\n         V_Err_Message := 'Address Id not found';\n         Fix_Dba.Dbpc_Blaster_Inserts.Write_Log (NULL,\n                                                 NULL,\n                                                 NULL,\n                                                 17690,\n                                                 'ADDRESS',\n                                                 V_Err_Message,\n                                                 'E',\n                                                 'AddressID',\n                                                 V_Address_Id,\n                                                 V_Efacts_Log_Id);\n      END LOOP;\n\n  CLOSE Record_Not_Found;\n\n\n END;\nEND;\n/\n</code></pre>\n",
  "link" : "https://stackoverflow.com/questions/44826608/updating-600k-rows-most-of-the-columns-are-varchar245-this-update-is-taking",
  "owner" : {
    "user_id" : 3263715,
    "user_type" : "registered",
    "display_name" : "user3263715",
    "profile_image" : "https://www.gravatar.com/avatar/6181aa2eda07473cad94b75a50c75af1?s=128&d=identicon&r=PG&f=1",
    "link" : "https://stackoverflow.com/users/3263715/user3263715",
    "reputation" : 1,
    "accept_rate" : null
  },
  "is_answered" : false,
  "creation_date" : 1498743153,
  "last_activity_date" : 1498743153,
  "tags" : [
    "sql",
    "plsql",
    "oracle11g"
  ],
  "score" : 0,
  "view_count" : 12,
  "answer_count" : 0
}