{
  "question_id" : 44826856,
  "title" : "MediaRecorder.start blocks my app and then crashes with Fatal Signal 11",
  "body" : "<p>I have a RecyclerView, with the Devices I got on my phone/tv box set. (Camera, Mic, Audio). I go through the items with a remote control (the app is for a tv box set), and on focusChanged, I have a callback which does this:</p>\n\n<pre><code>  devicesAdapter = new DevicesAdapter(getActivity(), new DevicesAdapter.FocusCallback() {\n        @Override\n        public void callBack(int code, boolean hasFocus, String deviceID) {\n            switch (code) {\n                case 0:\n                    setFocusDevices();\n                    break;\n                case 1:\n                    if (hasFocus) {\n                        releaseCamera(cameraF);\n                        refreshCameraWithId(Integer.valueOf(deviceID));\n                        cameraRelative.setVisibility(View.VISIBLE);\n                        micPreview.setVisibility(View.GONE);\n                        speakerPreview.setVisibility(View.GONE);\n                        micVolume = null;\n                    }\n                    break;\n                case 2:\n                    if (hasFocus) {\n                        cameraRelative.setVisibility(View.GONE);\n                        micPreview.setVisibility(View.VISIBLE);\n                        speakerPreview.setVisibility(View.GONE);\n                        if (true) {\n                            soundMeterStarted = true;\n                            soundMeter.start();\n                            micVolume = new Runnable() {\n                                @Override\n                                public void run() {\n                                    try {\n                                        double amplitude = soundMeter.getAmplitude();\n                                        Log.i(\"\", \"soundMeter MaxAplitude:\" + amplitude);\n                                        double viewThreshold = 2048;\n                                        int[] micIDS = new int[]{R.id.white1, R.id.white2, R.id.white3, R.id.white4, R.id.white5, R.id.white6, R.id.white7, R.id.white8, R.id.white9, R.id.white10, R.id.white11, R.id.white12, R.id.white13, R.id.white14, R.id.white15, R.id.white16};\n                                        for (int i = 1; i &lt; 17; i++) {\n                                            View view = rootView.findViewById(micIDS[i - 1]);\n                                            Log.i(\"\", \"view background: \" + view.getBackground().toString());\n                                            if (amplitude &gt; i * viewThreshold) {\n                                                view.setBackgroundResource(R.drawable.white_mic_value);\n                                            } else {\n                                                view.setBackgroundResource(R.drawable.half_white_mic_value);\n                                            }\n                                        }\n                                    } finally {\n                                        // 100% guarantee that this always happens, even if\n                                        // your update method throws an exception\n                                        if (micVolume != null &amp;&amp; soundMeterStarted)\n                                            handler.postDelayed(micVolume, 200);\n                                    }\n                                }\n                            };\n                            handler.post(micVolume);\n                        }\n                    } else {\n                        soundMeter.stop();\n                        handler.removeCallbacks(micVolume);\n                        soundMeterStarted = false;\n                    }\n                    break;\n                case 3:\n                    if (hasFocus) {\n                        cameraRelative.setVisibility(View.GONE);\n                        micPreview.setVisibility(View.GONE);\n                        speakerPreview.setVisibility(View.VISIBLE);\n                        micVolume = null;\n\n                        createVisualizer();\n\n                    } else {\n                        stopMediaPlayer();\n                    }\n                    break;\n            }\n        }\n    });\n</code></pre>\n\n<p>The case I'm interested is case 2 (which is related to the microphones connected to the app).</p>\n\n<p>As you can see, if it has focus, I call <code>soundMeter.start()</code> and when I stop: <code>soundMeter.stop()</code>.</p>\n\n<p>The SoundMeter class:</p>\n\n<pre><code>public class SoundMeter {\n\nprivate MediaRecorder mRecorder = null;\n\npublic void start() {\n    try {\n        if (mRecorder == null) {\n            mRecorder = new MediaRecorder();\n            mRecorder.setAudioSource(MediaRecorder.AudioSource.MIC);\n            mRecorder.setOutputFormat(MediaRecorder.OutputFormat.THREE_GPP);\n            mRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AMR_NB);\n            mRecorder.setOutputFile(\"/dev/null\");\n            mRecorder.prepare();\n            mRecorder.start();\n        }\n    }catch (Exception e){\n        Log.e(\"\",\"error while starting: \" + e.getMessage());\n    }\n}\n\npublic void stop() {\n    if (mRecorder != null) {\n        mRecorder.stop();\n        mRecorder.release();\n        mRecorder = null;\n    }\n}\n\npublic double getAmplitude() {\n    if (mRecorder != null)\n        return  mRecorder.getMaxAmplitude();\n    else\n        return 0;\n\n}\n}\n</code></pre>\n\n<p>If I remove the start and stop, it works perfectly.\nBUT when I have the start and stop inside, if I play with the list, go left and right, after a while it will crash with this error: </p>\n\n<p><a href=\"https://pastebin.com/YadkK5DC\" rel=\"nofollow noreferrer\">https://pastebin.com/YadkK5DC</a></p>\n",
  "link" : "https://stackoverflow.com/questions/44826856/mediarecorder-start-blocks-my-app-and-then-crashes-with-fatal-signal-11",
  "owner" : {
    "user_id" : 1307987,
    "user_type" : "registered",
    "display_name" : "rosu alin",
    "profile_image" : "https://www.gravatar.com/avatar/a4bbce19ea91ac93a7fdb9a25b4ad0a4?s=128&d=identicon&r=PG",
    "link" : "https://stackoverflow.com/users/1307987/rosu-alin",
    "reputation" : 1942,
    "accept_rate" : 92
  },
  "is_answered" : false,
  "creation_date" : 1498743752,
  "last_activity_date" : 1498743752,
  "tags" : [
    "android",
    "audio",
    "release",
    "microphone",
    "mediarecorder"
  ],
  "score" : 0,
  "view_count" : 3,
  "answer_count" : 0
}